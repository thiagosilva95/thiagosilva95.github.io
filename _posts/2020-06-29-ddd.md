---
layout: post
title: Domain Driven Design
featured-img: ddd
category: [architecture, best practices, development]
mathjax: true
summary: Vamos falar um pouco sobre essa "nova" forma de estruturar seus projetos, suas vantagens e desvantagens, e um exemplo prático de sua utilização 
---

# Entendendo o DDD

![]({{ "assets/img/ddd/ddd.png" | absolute_url }})

DDD não é uma receita para desenvolver software em camadas.

O DDD é uma abordagem de modelagem de software que segue um conjunto de práticas com o objetivo de facilitar a implementação de regras complexas ou processos de negócios que tratamos como domínio.

É uma super abordagem arquitetural. Talvez uma das mais conhecidas e faladas da atualidade.
Abordagem arquitetural = forma de pensar, desenhar e desenvolver aplicações. Midset na sua totalidade.
Application = padrões como Facade.
Domain = padrões comportamentaisfer

É uma forma de desenvolver software que tem como objetivo implementar o melhor design possível baseado em modelos que refletem a competência da organização.

Ajuda a dev que tras vantagem competi. Força a empresa a entender no que ela deve se distinguir. Identificação do core doamin.  Colabroação com os especialistas de domínio.



+ filosofia de desenvolvimento

complexadade do software = complexadade do domínio x complexadade técnica acidental

La tras o arquiteto pensa, camada de banco, envio de e-mail. Robusta, esparra nas barreiras arquiuteturais. Furar as barreiras
O conhecimento do negócio tras as necessidades que não conseguíamos ver no começo. O negócio evolui

Começar mais simples e ir evoluindo a medida que o negócio também evolui


### Big Ball of Mud


![]({{ "assets/img/ddd/bbom.png" | absolute_url }})

### Análise e desenvolvimento tradicional

![]({{ "assets/img/ddd/analise-dev-tradicional.png" | absolute_url }})

Com ddd:

![]({{ "assets/img/ddd/com-ddd.png" | absolute_url }})

Linguagem Ubíqua

Linguagem mais próxima da área de negócio e não dos desenvolvedores

Se extrair um diagrama de classe e mostrar a um especialista e mostrar para o usuário, ele vai conseguir entender e validar o modelo de negócio? Se sim, está próx do DDD.


Case "Fluxo de produção por demanda"

![]({{ "assets/img/ddd/substantivos.png" | absolute_url }})

Começa riscar os substantivos. Pensando o modelo de dados.
DDD fala que o projeto não é um repositório de dados, (isso seria um crud), ddd fala que o projeto é conjunto de eventos que precisa ser tratado

Com DDD

![]({{ "assets/img/ddd/verbos.png" | absolute_url }})

Em algum momento chega na modelagem dos dados mas primeiro é nas ações que o sistema precisa tratar


## Quando e por quem foi criado?

Livro da capa azul

Eric Evans – 2003

DDD é algo mutável. DDD e microserviço fazem muito sentido nos dias de hoje.

Fácil de entender e difícil de aplicar.

Na área técnica, utiliza vários padrões de projetos. Mas simplesmente utilizar esses padrões de projetos não significa que você está utilizando DDD.


## Domínio

Tudo que compreende o software e faz com que ele funcione.

Espaço problema que a equipe está inserida. Assunto do seu projeto.

Modelar o domínio é tipo um documentário sobre a vida de uma pessoa
Colocar esforço necessário no que a aplicação precisa para funcionar.


Core domain 
É onde  a m
Banco imobiliário = modelo
Mercado imobiliário = domínio

Maquetes -> construção

## Design estratégico x tático

"Design estratégico é como fazer o *rascunho* antes de entrar nos detalhes da *implementação*. Destaca o que é estrategicamente importante para o seu negócio, como *dividir o trabalho* por importância e como fazer *integrações* da melhor maneira."

"DDD é primariamente sobre modelar uma *linguagem ubíqua* em um *contexto delimitado*"

Vaughn Vernon

Contexto delimitado é uma barreira semântica onde todos os componentes do modelo terão um significado específico

LU fornece as palavras que existirá nesse contexto. Ubíqua porque ela vai está implementada no código do software.

Contexto precisa ser transformado em código

## Os pilares do DDD

### Linguagem Ubíqua

Quando se estuda DDD pode ficar até cansando em falar na linguagem ubíqua. 

###	Bounded Contexts

Significa contextos delimitados. Até aonde vai a responsabilidade de cada parte do sistema.

###	Context Maps

Uma vez que você delimita corretamente os contextos você consegue criar um mapa de como eles estão dispostos.

Entender esses pilares não significa que vai codificar. Mas espera que você vá entender a teoria.

Muitas pessoas leem o livro e acham que vão sair codificando.

Perguntaram ao Eric Evans que se ele pudesse modificar no livro ele começaria falando primeiro ou focar mais em bounded contexts


## Linguagem Ubíqua

![]({{ "assets/img/ddd/ul.png" | absolute_url }})

Se olhar esses termos de forma isolada acaba não sabendo do que se trata. Pode ter ideias mas não certeza. 
LU vai colocar o preto no branco.
Modelagem mini Netflix
LU será utilizada no processo de codificação.
Uma vez definida, será utilizada até o fim.

## Bounded Contexts

Delimita os contextos da aplicação.
Cada contexto possui suas responsabilidades claramente definidas. (Pagamento, assinatura, frete)
Cada contexto pode ter sua própria LU.
Você trabalha em departamento de vendas. Cliente faz ordem de serviço. 
Marketing pode ser o consumidor de propragandas etc.
Cliente que compra x cliente que vende.
Entidades com mesmo nome porém em contexto diferentes.
Utilização de histórias e levantamento do escopo do projeto com o domain expert auxilia no processo de delimitação dos contextos.

Exemplo de história



## Modelagem estratégica

![]({{ "assets/img/ddd/modelagem.png" | absolute_url }})

Definir os contextos que vou utilizar no sistema

Domínio principal. A Netflix não existe sem a entidade vídeo.

Para isso, podemos criar um adapter entre os dois que terá a tarefa de converter as interfaces do controller para a realidade do Express. Uma das particularidades do Express é que ele espera receber o (req, res) como parâmetros nas rotas definidas. 

## Bounded Contexts

Pega os contextos e monta o mapa para entender a relação entre eles.

Catálogo = Upstream
Perfil = Downstream
Catáglo manda em quem utiliza ele ou em quem ele utiliza. Ele é o domínio principal. 
Relação cliente - fornecedor.
Mesma coisa em catálogo e minha lista. Não se muda uma API em minha lista e precisa alterar o catálogo.


## Arquitetura Contextual

![]({{ "assets/img/ddd/aggregates.png" | absolute_url }})


## Domain Model Patterns

Padrões de dev e estruturação  de aplica cujo domínio é o principal foco.
Focados em Entidades de Agregadores
Objetos de valor
Repositórios
Serviços
Eventos de domínio

### Abordagem "clássica" do DDD

![]({{ "assets/img/ddd/abordagem-classica-ddd.png" | absolute_url }})

Domain faz tudo o que o model não deve fazer

ReservaService – cliente, sala, etc.

### Value Objects

![]({{ "assets/img/ddd/vo1.png" | absolute_url }})

Coleção de atributos
Normalmente não possuem métodos seters
Entrada dos valores através do construtor
Tipagem forte ao invés de dados primitivos.

Valor mensurado pelo conteúdo que ele carrega
Objeto atômico. Não tem get ou set
Ele deve se validar.

Coleção de dados individuais
Destinado para ser uma coleção de atributos
Imutável
Mais preciso que os tipos primitivos

Agrega valor a uma entidade
Imutável => set privado, alteração via construtor. Mudar o dado deve criar um novo objeto.
Modelagem complexa


### Entidade

Entidades possui os principais métodos e validadores.
Entidade não sabe da existência da camada de dados.

Possuem identidade
Deve ser exclusva para o objeto mapeado
Possui estados e comportamentos
Possui lógica de negócios, mas não faz persistência

### Aggregates

![]({{ "assets/img/ddd/aggregates.png" | absolute_url }})

Um conjunto de entidades usadas e referenciadas juntas
Um conjunto de entidade tratadas como uma quando o dado é alterado 
Possui uma raiz de agragação (Aggregation Root)
Mantém a integridade do objeto

É uma entidade com característica diferentes.
Várias entidades usadas e referenciadas juntas.
Em alguns pontos de vista, seria uma entidade só

![]({{ "assets/img/ddd/aggregates2.png" | absolute_url }})

Quando a entidade está isolada, ela é sua própria raiz de agregação.

Proteger/evitar o acesso direto aos objetos filhos
Certificar que o estado dos objetos filhos está sempre consistente
Os limites de uma agregação é determinada pela regra de negócio

![]({{ "assets/img/ddd/aggregates3.png" | absolute_url }})

Pergunta para entender o limite?
Pergunta se esse endereço serve pra outra coisa além de pertencer a um cliente.

Apenas um repositório por agregação


### Repositório

Tem acesso direto a camada de dados
Persiste dados utilizando as entidades
Possui os métodos necessários para consultar
Utiliza sempre um repositório por agregação e não por entidade
Pode consultar diretamente serviços externos

### Serviços de domínio

Implementa a lógica de negócio a partir de uma definição de um expert de domínio.
Trabalham com diversos fluxos de diversas entidades e agregações.
Utilizam os repositórios como interface de acesso aos dados.
Consumem recursos da camada de infra como enviar e-mail, disparar eventos, entre outros.


### Juntando os pedaços

![]({{ "assets/img/ddd/juntando-pedacos.png" | absolute_url }})

Normalmente cada contexto pode ser transformado em um microserviço.

## DDD x Microservices

Em projetos vemos um padrão recorrente que é o Conway’s Law= solução tendem a refletir a estrutura organizacional da empresa. 

Tres times começam a contruir serviços. Tendencia que agrupe os serviços de acordo com os times.

![]({{ "assets/img/ddd/conways-law.png" | absolute_url }})

Com o DDD queremos aproximar o técnico da realidade de negócio.

![]({{ "assets/img/ddd/conways-law-ddd.png" | absolute_url }})

Event storming 
Postits sobre eventos da aplicação. Isso pode clarificar muitas coisas para os membros da equipe. Faz um caminho que o software percorre (ordenado).


## Considerações Finais

Vale a pena usar DDD pra tudo?
Vale a pena pra quase tudo


## Referências

Artigo do [Uncle Bob](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html) sobre Clean Architecture.

Curso NodeJs, Typescript, TDD, Clean Architecture e SOLID na [Udemy](https://www.udemy.com/course/tdd-com-mango/) do Rodrigo Manguinho.


